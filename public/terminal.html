<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minecraft Terminal</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css"
    />
    <style>
      /* Terminal Styling */
      #terminal-container {
        background: #2d2d2d; /* Dark background */
        color: #a8e6a1; /* Light green text */
        padding: 10px;
        height: 400px; /* Match the log height */
        overflow-y: auto; /* Allow scrolling but stay within bounds */
        overflow-x: hidden; /* Prevent horizontal scrolling */
        border: 1px solid #ccc; /* Similar border to logs */
        white-space: pre-wrap; /* Handle long lines */
        font-family: "Courier New", monospace; /* Monospace font */
        font-size: 14px; /* Adjust font size to match log */
        border-radius: 8px; /* Match the rounded corners */
        width: 100%; /* Ensure full width */
        box-sizing: border-box; /* Prevent padding from expanding beyond container width */
        position: relative; /* Keep inside the parent container */
      }

      #terminal {
        height: 100%;
        width: 100%;
        background: transparent; /* Allow the background color to show through */
        color: #a8e6a1; /* Same color as the log text */
        display: block; /* Ensures terminal stretches to full container width */
      }

      /* Adjust terminal input style (e.g., cursor) */
      .xterm .xterm-cursor {
        background-color: #a8e6a1; /* Match the text color for cursor */
      }
    </style>
  </head>
  <body>
    <div id="terminal"></div>

    <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit/lib/xterm-addon-fit.min.js"></script>
    <script>
      const terminal = new Terminal({
        fontFamily: "monospace",
        fontSize: 14,
        cursorBlink: true,
        theme: {
          background: "#2d2d2d" /* Dark background */,
          foreground: "#a8e6a1" /* Light green text */,
        },
      });

      const fitAddon = new FitAddon.FitAddon();
      terminal.loadAddon(fitAddon);

      terminal.open(document.getElementById("terminal"));
      fitAddon.fit();

      const protocol = location.protocol === "https:" ? "wss" : "ws";
      const token = localStorage.getItem("token");
      const socket = new WebSocket(`${protocol}://localhost:3000/ws/terminal?token=${token}`);

      socket.addEventListener("open", () => {
        terminal.writeln("Connected to server.\r\n");
      });

      socket.addEventListener("message", (event) => {
        terminal.write(event.data);
      });

      socket.addEventListener("close", () => {
        terminal.writeln("\r\n[Connection closed]");
      });

      socket.addEventListener("error", (err) => {
        console.error("WebSocket error:", err);
        terminal.writeln("\r\n[WebSocket error]");
      });

      terminal.onData((data) => {
        socket.send(data);
      });

      // Resize terminal on window resize
      window.addEventListener("resize", () => {
        fitAddon.fit();
      });
    </script>
  </body>
</html>
